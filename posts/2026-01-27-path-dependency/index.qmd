---
title: "Path Dependency Risk"
author: "Aleksandra"
date: "2026-01-27"
categories: [finance]
image: "thumb.jpeg"
description: "nice correpsondence to function states - or a contradiction thereof"
title-block-banner: true
---

And now let's compare it to a plot of a stock price:

## Static Plot: Full Historical View

```{r}
#| echo: false
#| warning: false

library(plotly)
library(dplyr)
library(readr)


# Load Shiller's data from post directory
df <- read_csv("monthly_dt_min.csv", show_col_types = FALSE)

# Create cumulative average dataframe using dplyr
df_cumul <- df %>%
  select(year, jan_price) %>%
  distinct(year, .keep_all = TRUE) %>%
  arrange(year) %>%
  mutate(
    pct_change = (jan_price / lag(jan_price) - 1) * 100
  ) %>%
  filter(!is.na(pct_change)) %>%  # Remove 1871 (no previous year, so no yearly data for averaging)
  mutate(
    cum_avg_pct_change = cummean(pct_change)
  )

# Create static plot with both traces
fig_static <- plot_ly(df_cumul, x = ~year) %>%
  add_trace(
    y = ~pct_change,
    type = 'scatter',
    mode = 'lines+markers',
    name = '% Change',
    line = list(color = 'orange', width = 2),
    marker = list(size = 3),
    hovertemplate = '%{y:.1f}%<extra></extra>'
  ) %>%
  add_trace(
    y = ~cum_avg_pct_change,
    type = 'scatter',
    mode = 'lines',
    name = 'Cumulative Avg % Change',
    line = list(color = 'blue', width = 3, dash = 'dash'),
    hovertemplate = '%{y:.1f}%<extra></extra>'
  ) %>%
  layout(
    title = "Yearly % Change and Cumulative Avg % Change (1872-2024)",
    xaxis = list(title = "Year"),
    yaxis = list(
      title = "Percent Change",
      tickformat = '.1f'
    ),
    plot_bgcolor = "white",
    paper_bgcolor = "white",
    margin = list(l = 60, r = 60, t = 60, b = 60),
    legend = list(orientation = 'h', x = 0.5, xanchor = 'center', y = -0.2)
  )

fig_static
```

## Interactive Plot: Adjustable Time Range

Select a time range to see how the cumulative average changes when calculated from different starting points:

Mind that the value of year x1 (selected as starting year) builds on the Jan value from year x0, eg.  
```{r}
#| echo: false
#| warning: false

library(htmlwidgets)

# Prepare data for JavaScript (using df_cumul from previous chunk)
years_list <- df_cumul$year
pct_change_list <- df_cumul$pct_change
jan_price_list <- df_cumul$jan_price

# Read external JavaScript file
js_code <- readLines("plot_interactive.js", warn = FALSE)
js_code <- paste(js_code, collapse = "\n")

# Create interactive plot
fig_interactive <- plot_ly() %>%
  layout(
    title = "Yearly % Change and Cumulative Avg (Adjustable Range)",
    xaxis = list(title = "Year"),
    yaxis = list(title = "Percent Change"),
    plot_bgcolor = "white",
    paper_bgcolor = "white"
  )

# Add HTML controls
fig_interactive <- fig_interactive %>%
  htmlwidgets::prependContent(
    htmltools::tags$div(
      style = "margin-bottom: 20px; padding: 15px; background-color: #f0f0f0; border-radius: 5px;",
      htmltools::tags$label(
        "Start Year: ",
        htmltools::tags$input(
          type = "number",
          id = "startYear",
          value = 1880,
          min = 1872,
          max = 2024,
          style = "padding: 5px; margin: 0 10px; width: 80px;"
        )
      ),
      htmltools::tags$label(
        "End Year: ",
        htmltools::tags$input(
          type = "number",
          id = "endYear",
          value = 1910,
          min = 1872,
          max = 2024,
          style = "padding: 5px; margin: 0 10px; width: 80px;"
        )
      ),
      htmltools::tags$button(
        "Update Plot",
        onclick = "updatePlot()",
        style = "padding: 5px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 3px; cursor: pointer;"
      )
    )
  )

# Attach JavaScript from external file
fig_interactive <- fig_interactive %>%
  htmlwidgets::onRender(
    sprintf(
      "function(el, x) {
        %s
        initInteractivePlot(el, {years: %s, pctChange: %s, janPrice: %s});
      }",
      js_code,
      jsonlite::toJSON(years_list, auto_unbox = TRUE),
      jsonlite::toJSON(pct_change_list, auto_unbox = TRUE, null = "null"),
      jsonlite::toJSON(jan_price_list, auto_unbox = TRUE)
    )
  )

fig_interactive
``` 


Thank you for reading. 